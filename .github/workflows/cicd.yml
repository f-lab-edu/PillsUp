# This workflow will build a Swift project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

name: cicd

on:
  push:
    branches: [ "feature/018-cicd" ]
  workflow_dispatch:

jobs:
  macos-build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    - name: 🛠️ Domain Package Tests 🛠️
      run: |
         xcodebuild test \
         -project PillsUp/PillsUp.xcodeproj \
         -scheme DomainTests \
         -destination 'platform=iOS Simulator,name=iPhone 14,OS=15' \
         -enableCodeCoverage YES \
         -allowProvisioningUpdates
         
    - name: 📈 Upload CodeCoverage 📈
      uses: codecov/codecov-action@v1.2.1
      with:
        token: ${{ secrets.CODECOV_TOKEN }}
        
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: 🧪 GitHub Action for SwiftLint 🧪
      uses: norio-nomura/action-swiftlint@3.2.1

    - name: ✅ Add PR Comment ✅
      if: ${{ success() }}
      uses: mshick/add-pr-comment@v1
      with:
        message: |
           ## All File Checked ✅
           | ✅ 	| Auto Pull Request SwiftLint Success!!!! 	|
           |---	|-------------------------------------------  |
           ## All File Checked ✅
           | ✅ 	| Auto Pull Request SwiftLint Success!!!! 	|
           |---	|-------------------------------------------	|
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        repo-token-user-login: 'github-actions[bot]'
        allow-repeats: false 
        continue-on-error: true

    - name: ❌ Add PR Failure Comment ❌
      if: ${{ failure() }}
      uses: mshick/add-pr-comment@v1
      with:
        message: |
          ## SwiftLint Check Failed ❌
          | ❌ 	| SwiftLint failed with errors. Please check the logs for more details. 	|
          |---	|-------------------------------------------------------------	|
          | 🛠 	| [Check the Action Logs for more details](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        repo-token-user-login: 'github-actions[bot]'
        allow-repeats: false 
    

