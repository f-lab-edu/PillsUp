#!/bin/sh

# find . -name "*.swift" | while read file; do
#   sed -i '' -e 's/[[:space:]]*$//' "$file"
#   if [ -n "$(tail -c 1 "$file")" ]; then
#     echo "" >> "$file"
#   fi
# done

# SwiftLint ì‹¤í–‰
echo "Running SwiftLint..."
RESULT=$(swiftlint lint --use-stdin --quiet <<< "$(cat $FILES)")

if [ $? -eq 0 ]; then
	printf "âœ¨  SwiftLint ì ìš©ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!! ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤:)\n"
else
	echo ""
	printf "âœ” SwiftLint Failed ì•„ëž˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”:\n"
  while read -r line; do
    FILEPATH=$(echo $line | cut -d : -f 1)
    L=$(echo $line | cut -d : -f 2)
    C=$(echo $line | cut -d : -f 3)
    TYPE=$(echo $line | cut -d : -f 4 | cut -c 2-)
    MESSAGE=$(echo $line | cut -d : -f 5 | cut -c 2-)
    DESCRIPTION=$(echo $line | cut -d : -f 6 | cut -c 2-)
    if [ $TYPE = 'warning' ]; then
      printf "\n ðŸš§  $TYPE\n"
      warning íƒ€ìž…ì€ ì˜¤ë¥˜ë©”ì‹œì§€ë§Œ í‘œì‹œí•˜ê³  ì»¤ë°‹ì„ í—ˆìš©í•˜ê³  ì‹¶ë‹¤ë©´ line 40~42 ì£¼ì„ í•´ì œ.
      printf "    $FILEPATH:$L:$C\n"
      printf "    ðŸ“Œ  $MESSAGE: - $DESCRIPTION\n"
      exit 0
    elif [ $TYPE = 'error' ]; then
      printf "\n ðŸš¨  $TYPE\n"
    fi
    printf "    âœ” $FILEPATH:$L:$C\n"
    printf "    ðŸ“Œ $MESSAGE: - $DESCRIPTION\n"
  done <<< "$RESULT"

  printf "\n ðŸš‘  ì»¤ë°‹ì‹¤íŒ¨!! Swiftlint ruleì— ë§žê²Œ ì½”ë“œë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”:)\n"
  exit 1
fi